/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

(function($){var Plugin=function(){};$.extend(Plugin.prototype,{name:"dropdownMenu",options:{mode:"default",itemSelector:"li",firstLevelSelector:"li.level1",dropdownSelector:"ul",duration:600,remainTime:800,remainClass:"remain",transition:"easeOutExpo",withopacity:true,centerDropdown:false,reverseAnimation:false,fixWidth:false,fancy:null},initialize:function(element,options){this.options=$.extend({},this.options,options);var $this=this,lastactive=null,remain=false;this.menu=element;this.dropdowns=[];this.options.withopacity=$.support.opacity?false:this.options.withopacity;if(this.options.fixWidth){var fixwidth=5;this.menu.children().each(function(){fixwidth+=$(this).width()});this.menu.css("width",fixwidth)}this.menu.find(this.options.firstLevelSelector).each(function(index){var item=$(this);var dropdown=item.find($this.options.dropdownSelector).css({overflow:"hidden"});if(dropdown.length){dropdown.css("overflow","hidden");var div=$("<div>").data("dpwidth",parseFloat(dropdown.width())).data("dpheight",parseFloat(dropdown.height())).css({overflow:"hidden"}).append("<div></div>");var innerdiv=div.find("div:first").css({"min-width":div.data("dpwidth"),"min-height":div.data("dpheight")});dropdown.children().appendTo(innerdiv);div.appendTo(dropdown);if($this.options.centerDropdown)dropdown.css("margin-left",(parseFloat(dropdown.css("width"))/2-item.width()/2)*-1);$this.dropdowns.push({dropdown:dropdown,div:div,innerdiv:innerdiv})}item.bind({mouseenter:function(event){remain=true;$this.menu.trigger("menu:enter",[item,index]);if(lastactive){if(lastactive.index==index)return;lastactive.item.removeClass($this.options.remainClass);lastactive.div.hide()}if(!dropdown.length){active=null;lastactive=null;return}item.addClass($this.options.remainClass);div.stop().show();var dpwidth=div.data("dpwidth");var dpheight=div.data("dpheight");switch($this.options.mode){case"diagonal":var from={width:0,height:0};var to={width:dpwidth,height:dpheight};if($this.options.withopacity){from.opacity=0;to.opacity=1}div.css(from).animate(to,$this.options.duration,$this.options.transition);break;case"height":var from={width:dpwidth,height:0};var to={height:dpheight};if($this.options.withopacity){from.opacity=0;to.opacity=1}div.css(from).animate(to,$this.options.duration,$this.options.transition);break;case"width":var from={width:0,height:dpheight};var to={width:dpwidth};if($this.options.withopacity){from.opacity=0;to.opacity=1}div.css(from).animate(to,$this.options.duration,$this.options.transition);break;case"slide":dropdown.css({width:dpwidth,height:dpheight});div.css({width:dpwidth,height:dpheight,"margin-top":dpheight*-1}).animate({"margin-top":0},$this.options.duration,$this.options.transition);break;default:var from={width:dpwidth,height:dpheight};var to={};if($this.options.withopacity){from.opacity=0;to.opacity=1}div.css(from).animate(to,$this.options.duration,$this.options.transition)}lastactive={item:item,div:div,index:index}},mouseleave:function(event){if(event["srcElement"]&&$(event.srcElement).hasClass("module")){return false}remain=false;if(!dropdown.length){$this.menu.trigger("menu:leave");return}window.setTimeout(function(){if(remain||div.css("display")=="none")return;$this.menu.trigger("menu:leave",[item,index]);var finalize=function(){item.removeClass($this.options.remainClass);lastactive=null;div.hide()};if(!$this.options.reverseAnimation){finalize();return}switch($this.options.mode){case"diagonal":var to={width:0,height:0};if($this.options.withopacity)to.opacity=0;div.stop().animate(to,$this.options.duration,$this.options.transition,function(){finalize()});break;case"height":var to={height:0};if($this.options.withopacity)to.opacity=0;div.stop().animate(to,$this.options.duration,$this.options.transition,function(){finalize()});break;case"width":var to={width:0};if($this.options.withopacity)to.opacity=0;div.stop().animate(to,$this.options.duration,$this.options.transition,function(){finalize()});break;case"slide":div.stop().animate({"margin-top":parseFloat(div.data("dpheight"))*-1},$this.options.duration,$this.options.transition,function(){finalize()});break;default:var to={};if($this.options.withopacity)to.opacity=0;div.stop().animate(to,$this.options.duration,$this.options.transition,function(){finalize()})}},$this.options.remainTime)}})});if(this.options.fancy){var fancyoptions=$.extend({mode:"move",transition:"easeOutExpo",duration:500,onEnter:null,onLeave:null},this.options.fancy);var fancy=this.menu.append('<div class="fancy bg1"><div class="fancy-1"><div class="fancy-2"><div class="fancy-3"></div></div></div></div>').find(".fancy:first").hide();var start=this.menu.find(".active:first");var fancycurrent=null;var fancyMove=function(to,show,index){if(show&&fancycurrent&&to.get(0)==fancycurrent.get(0))return;fancy.stop().show().css("visibility","visible");if(fancyoptions.mode=="move"){if(!start.length&&!show){fancy.hide()}else{fancy.animate({left:to.position().left+"px",width:to.width()+"px"},fancyoptions.duration,fancyoptions.transition)}}else{if(show){fancy.css({opacity:start?0:1,left:to.position().left+"px",width:to.width()+"px"}).animate({opacity:1},fancyoptions.duration)}else{fancy.animate({opacity:0},fancyoptions.duration)}}fancycurrent=show?to:null};this.menu.bind({"menu:enter":function(e,current,index){fancyMove(current,true);if(fancyoptions.onEnter){fancyoptions.onEnter(current,index,fancy)}},"menu:leave":function(e,current,index){fancyMove(start,false);if(fancyoptions.onLeave){fancyoptions.onLeave(current,index,fancy)}}});if(start.length&&fancyoptions.mode=="move")fancyMove(start,true)}},matchHeight:function(){if(this.menu){this.menu.find("li.level2 div.sub").each(function(){var sub=$(this);var hover=sub.parent().find("div.hover-box4:first");var height=Math.max(sub.height(),hover.height());$([sub,hover]).each(function(){this.css("height",height)})});this._updateDimensions()}},matchUlHeight:function(){if(this.menu){this.menu.find("div.dropdown-3").each(function(){var elements=$(this).children();var height=0;$(elements).each(function(){height=Math.max($(this).height(),height)});$(elements).each(function(){$(this).css("height",height)})});this._updateDimensions()}},_updateDimensions:function(){$(this.dropdowns).each(function(i,d){d.div.stop().show().data({dpwidth:d.innerdiv.width(),dpheight:d.innerdiv.height()}).hide();d.dropdown.css({"min-width":d.div.data("dpwidth"),"min-height":d.div.data("dpheight")})})}});$.fn[Plugin.prototype.name]=function(){var args=arguments;var method=args[0]?args[0]:null;return this.each(function(){var element=$(this);if(Plugin.prototype[method]&&element.data(Plugin.prototype.name)&&method!="initialize"){element.data(Plugin.prototype.name)[method].apply(element.data(Plugin.prototype.name),Array.prototype.slice.call(args,1))}else if(!method||$.isPlainObject(method)){var plugin=new Plugin;if(Plugin.prototype["initialize"]){plugin.initialize.apply(plugin,$.merge([element],args))}element.data(Plugin.prototype.name,plugin)}else{$.error("Method "+method+" does not exist on jQuery."+Plugin.name)}})}})(jQuery);