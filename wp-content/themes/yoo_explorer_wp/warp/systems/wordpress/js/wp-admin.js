/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

jQuery(function($){if($("#update-nav-menu").length){var form=$("#update-nav-menu");var force_submit=false;var post_body=form.find("#post-body");var menuIds=[];var pimper=function(){$(".menu-item-settings").each(function(){var sb=$(this);var tmp=sb.attr("id").split("-");var id=tmp[tmp.length-1];var html=[];if($.inArray(id,menuIds)!=-1)return;menuIds.push(id);html.push('<p class="description description-thin">');html.push('<label for="edit-menu-item-attr-columns-'+id+'">');html.push("Columns<br>");html.push('<select data-warp="menu" id="menu-item-'+id+'-columns" style="width:100%;" name="menu-item['+id+'][columns]"><option>1</option><option>2</option><option>3</option><option>4</option></select>');html.push("</label>");html.push("</p>");html.push('<p class="description description-thin">');html.push('<label for="edit-menu-item-attr-columns-'+id+'">');html.push("Column Width<br>");html.push('<input data-warp="menu" type="text" id="menu-item-'+id+'-columnwidth" style="width:100%;" name="menu-item['+id+'][columnwidth]" />');html.push("</label>");html.push("</p>");html.push('<p class="description description-thin">');html.push('<label for="edit-menu-item-attr-columns-'+id+'">');html.push("Image<br>");html.push('<input data-warp="menu" type="text" id="menu-item-'+id+'-image" style="width:100%;" name="menu-item['+id+'][image]" />');html.push("</label>");html.push("</p>");sb.find(".submitbox").before(html.join("\n"))})};pimper();$(".submit-add-to-menu").bind("click",function(){var fn=function(){$(".menu-item-settings").length>menuIds.length?pimper():window.setTimeout(fn,500)};window.setTimeout(fn,500)});form.bind("submit",function(){if(force_submit)return true;var data={action:"save_nav_settings"};form.find("[data-warp=menu]").each(function(){var ele=$(this);data[ele.attr("name")]=ele.val()});$.post(ajaxurl+"?action=save_nav_settings",data,function(response){force_submit=true;form.submit()});return false});$.getJSON(ajaxurl+"?action=get_nav_settings",function(menu_item_settings){$(menuIds).each(function(index,id){if(menu_item_settings[id]){for(var setting in menu_item_settings[id]){$("#menu-item-"+id+"-"+setting).val(menu_item_settings[id][setting])}}})})}});